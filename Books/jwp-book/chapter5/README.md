# 5장 웹 서버 리팩토링, 서블릿 컨테이너와 서블릿의 관계

요구사항에 대한 지식이 높아질수록 더 좋은 설계를 할 수 있으며, 더 깔끔한 코드를 구현할 수 있다.
이와 같이 설계는 한 번의 작업으로 끝내야 하는 것이 아니라 애플리케이션을 개발하고 배포해 운영하는 동안 끊임없이 진행해야 하는 것이 설계이다.
이와 같이 지속적인 설계와 구현을 잘 할 수 있는 방법이 지속적인 리팩토링이다.
리팩토링은 설계를 개선하기 위한 일련의 활동이다.

## 5.1 HTTP 웹 서버 리팩토링 실습

### 5.1.1 리팩토링할 부분 찾기

[리팩토링 : 코드 품질을 개선하는 객체지향 사고법](http://www.yes24.com/Product/Goods/7951038)(마틴 파울러 저/김지원 역, 한빛미디어/2012년): 리팩토링이 필요한 시접에 대한 정확한 기준을 제시하기보다 경험적으로 인간의 직관에 맡기고 있다.

### 5.1.2 리팩토링 1단계 힌트

#### 5.1.2.1 요청 데이터를 처리하는 로직을 별도의 클래스로 분리한다(HTTPRequest).

#### 5.1.2.2 응답 데이터를 처리하는 로직을 별도의 클래스로 분리한다(HttpResponse).

#### 5.1.2.3 다형성을 활용해 클라이언트 요청 URL에 대한 분기 처리를 제거한다.

클래스 다이어그램은 클래스 간의 관계를 쉽게 파악하기 위한 목적으로 사용하는 UML(Unified Modeling Language) 중의 하나이다.   
첫 번째는 인터페이스를 구현할 때(implements)와 상속(extends)의 경우 화살표 끝은 삼각형으로 같다.
다른 점은 인터페이스를 구현할 때는 점선으로 표시하고, 상속의 경우에는 실선으로 표시한다.   
두 번째는 클래스 간의 의존관계를 표시하는 부분이다.
클래스간의 의존관계는 열린 화살표를 사용한다.
단, 클래스의 의존관계가 클래스의 필드를 통해 연결되는 경우 실선, 메소드의 로컬 변수로 연결되는 경우 점선을 사용한다.
의존관계의 클래스를 해당 클래스의 인스턴스를 직접 생성하는 경우 `<<create>>`가 표시된다.

## 5.2 웹 서버 리팩토링 구현 및 설명

### 5.2.1 요청 데이터를 처리하는 로직을 별도의 클래스로 분리한다.

테스트 코드를 기반으로 개발할 경우, 첫번째 효과는 클래스에 버그가 있는지를 빨리 찾아 구현할 수 있다는 것이다.  
두번째 효과는 디버깅하기 쉽다는 것이다.
클래스에 대한 단위 테스트를 하는 것은 결과적으로 디버깅을 좀 더 쉽고 빠르게 할 수 있기 때문에 개발 생산성을 높여준다.  
세번째 효과는 테스트 코드가 있기 때문에 마음 놓고 리팩토링을 할 수 있다는 것이다.

private 메소드인데 로직의 복잡도가 높아 추가적인 테스트가 필요하다고 생각하는 메소드가 발생한다.
하지만 이 메소드만 별도로 분리해 테스트하기 힘들다.  
일반적으로 이를 해결하는 방법은 두 가지가 있다.  
첫째는 private 접근 제어자인 메소드를 default 접근 제어자로 수정하고 메소드 처리 결과를 반환하도록 수정해 테스트할 수 있다.  
둘째는 메소드 구현 로직을 새로운 클래스로 분리하는 방법이 있다.

### 5.2.2 응답 데이터를 처리하는 로직을 별도의 클래스로 분리한다.

### 5.2.3 다형성을 활용해 클라이언트 요청 URL에 대한 분기 처리를 제거한다.

OCP(개방폐쇄의 원칙, Open-Closed Principle) 원칙  
객체지향 설계 원칙 중 요구사항의 변경이나 추가사항이 발생하더라도, 기존 구성요소는 수정이 일어나지 말아야 하며, 기존 구성요소를 쉽게 확장해서 재사용할 수 있어야한다.

To be continued...
